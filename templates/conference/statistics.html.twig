{% extends 'index_admin.html.twig' %}

{% block body %}
<div class="container">

  <!-- Existing card blocks for total, responded, and pending reclamations -->
  <div class="row">
    <div class="col-xl-4 col-sm-6 mb-4">
      <div class="card">
        <div class="card-body">
          <h5>Total Reclamations</h5>
          <p>{{ statistics.total_reclamations }}</p>
        </div>
      </div>
    </div>
    <div class="col-xl-4 col-sm-6 mb-4">
      <div class="card">
        <div class="card-body">
          <h5>Responded Reclamations</h5>
          <p>{{ statistics.responded_reclamations }}</p>
        </div>
      </div>
    </div>
    <div class="col-xl-4 col-sm-6 mb-4">
      <div class="card">
        <div class="card-body">
          <h5>Pending Reclamations</h5>
          <p>{{ statistics.pending_reclamations }}</p>
        </div>
      </div>
    </div>
  </div>
  <!-- Pie Chart for Responded vs. Pending Reclamations -->
  <div class="row mt-4">
    <div class="col-lg-12">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Reclamation Response Distribution</h5>
          <div id="pie_chart_div" style="width: 100%; height: 500px;"></div>
        </div>
      </div>
    </div>
  </div>

     <!-- Line Chart and Prediction Box -->
     <div class="row mt-4">
     <div class="col-lg-10">
         <div class="card">
             <div class="card-body">
                 <h5 class="card-title">Daily Reclamation Trends</h5>
                 <div id="line_chart_div" style="width: 100%; height: 500px;"></div>
             </div>
         </div>
     </div>
     <div class="col-lg-2">
         <div class="card bg-warning text-white">
             <div class="card-body">
                 <h5 class="card-title">Future Prediction</h5>
                 <p class="card-text">
                     Based on current trends, we predict there will be approximately
                     <strong>{{ statistics.predicted_reclamations }}</strong>
                     reclamations tomorrow.
                 </p>
             </div>
         </div>
     </div>
 </div>
</div>

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
  google.charts.load('current', {'packages':['corechart']});
  google.charts.setOnLoadCallback(drawCharts);

  function drawCharts() {
    drawPieChart();
    drawLineChart();
  }

  function drawPieChart() {
    var pieData = google.visualization.arrayToDataTable([
      ['Type', 'Number'],
      ['Responded', {{ statistics.responded_reclamations }}],
      ['Pending', {{ statistics.pending_reclamations }}]
    ]);

    var pieOptions = {
      title: 'Response Distribution',
      pieHole: 0.4,
      colors: ['#4caf50', '#f44336'],
      chartArea: {width: '90%', height: '80%'}
    };

    var pieChart = new google.visualization.PieChart(document.getElementById('pie_chart_div'));
    pieChart.draw(pieData, pieOptions);
  }

  function drawLineChart() {
    var data = google.visualization.arrayToDataTable([
      ['Day', 'Reclamations'],
      {% for entry in statistics.reclamations_per_day %}
        ['{{ entry.day }}', {{ entry.count }}],
      {% endfor %}
    ]);

    var options = {
      title: 'Daily Reclamations',
      hAxis: {title: 'Day', titleTextStyle: {color: '#333'}},
      vAxis: {minValue: 0},
      chartArea: {width: '60%', height: '70%'},
      legend: {position: 'bottom'},
      pointSize: 5,
      lineWidth: 3,
      colors: ['#1c91c0']
    };

    var chart = new google.visualization.LineChart(document.getElementById('line_chart_div'));
    chart.draw(data, options);
  }
</script>
{% endblock %}
